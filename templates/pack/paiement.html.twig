{% extends 'base.html.twig' %}

{% block title %}Paiement du Pack {{ pack.nomPack }}{% endblock %}

{% block body %}
<div class="container my-5">
    <h1 class="text-center text-success mb-4">Paiement du Pack: {{ pack.nomPack }}</h1>
    
    <div class="card shadow-lg border-0 p-4">
        <div class="card-body text-center">
            {# Affichage de l'image du pack #}
            {% if pack.photoPack %}
                <img src="{{ asset(pack.photoPack) }}" class="card-img-top img-fluid" style="max-width: 300px; height: auto;" alt="Photo du pack {{ pack.nomPack }}">
            {% else %}
                <div class="text-center p-3 text-muted">Pas d'image</div>
            {% endif %}

            {# Détails du pack #}
            <h5 class="card-title text-success">{{ pack.nomPack }}</h5>
            <p class="card-text"><strong>Description:</strong></p>
            <p class="card-text">{{ pack.descriptPack|replace({'. ': '<br>'})|raw }}</p>

            {# Affichage du prix avec ou sans réduction #}
            <p class="card-text">
                <strong>Prix:</strong>
                {% if discountPrice and discountPrice < pack.prixPack %}
                    <span style="text-decoration: line-through;">{{ pack.prixPack|number_format(2, ',', ' ') }} €</span>
                    <strong class="text-danger ml-2">{{ discountPrice|number_format(2, ',', ' ') }} €</strong>
                {% else %}
                    {{ pack.prixPack|number_format(2, ',', ' ') }} €
                {% endif %}
            </p>

            <p class="card-text"><strong>Durée:</strong> {{ pack.dureePack }} jours</p>
        </div>
    </div>

    {# Formulaire de paiement #}
    <div class="row mt-5">
        <div class="col-md-6 mx-auto">
            <h3 class="text-center mb-4">Informations de paiement</h3>

         

            {# Choix du mode de paiement #}
            <div class="form-group mb-4">
                <label for="mode-paiement" class="form-label">Mode de paiement</label>
                <select id="mode-paiement" class="form-select">
                    <option value="carte">Carte bancaire</option>
                    <option value="paypal">PayPal</option>
                </select>
            </div>

            {# Formulaire pour carte bancaire (affiché par défaut) #}
            <div id="carte-info">
                <h4 class="text-center mb-3">Paiement par carte bancaire</h4>
                <div class="text-center mb-3">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Visa.svg/120px-Visa.svg.png" width="50">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/120px-Mastercard-logo.svg.png" width="50">
                </div>
                <div class="form-floating mb-3">
                    <input type="text" id="card-name" class="form-control" placeholder="Nom sur la carte" required>
                    <label for="card-name">Nom sur la carte</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" id="card-number" class="form-control" placeholder="Numéro de carte" required>
                    <label for="card-number">Numéro de carte</label>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="text" id="card-expiry" class="form-control" placeholder="MM/AA" required>
                            <label for="card-expiry">Date d'expiration</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="text" id="card-cvc" class="form-control" placeholder="CVC" required>
                            <label for="card-cvc">Cryptogramme visuel</label>
                        </div>
                    </div>
                </div>
            </div>

            {# Formulaire pour PayPal (masqué par défaut) #}
            <div id="paypal-info" style="display: none;">
                <h4 class="text-center mb-3">Paiement via PayPal</h4>
                <div class="text-center mb-3">
                    <img src="{{ asset('images/paypal.png') }}" width="120" alt="Logo PayPal">
                </div>
                <div class="form-floating mb-3">
                    <input type="email" id="paypal-email" class="form-control" placeholder="Adresse email PayPal" required>
                    <label for="paypal-email">Adresse email PayPal</label>
                </div>
                <div id="paypal-button-container">
    <a href="{{ path('paypal_pay', {'amount': discountPrice is defined ? discountPrice : pack.prixPack }) }}" class="btn btn-primary btn-lg">
        Payer avec PayPal
    </a>
</div>

            

            {# Bouton de confirmation de paiement #}
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg" id="confirm-payment">Confirmer le paiement</button>
                <a href="{{ path('packclient') }}" class="btn btn-secondary btn-lg">Annuler</a>
            </div>
        </div>
    </div>
</div>

<script>
// Gestion de l'affichage des formulaires de paiement
document.getElementById("mode-paiement").addEventListener("change", function() {
    let carteInfo = document.getElementById("carte-info");
    let paypalInfo = document.getElementById("paypal-info");

    // Masquer les deux formulaires par défaut
    carteInfo.style.display = "none";
    paypalInfo.style.display = "none";

    // Afficher le formulaire correspondant au mode de paiement sélectionné
    if (this.value === "carte") {
        carteInfo.style.display = "block";
    } else if (this.value === "paypal") {
        paypalInfo.style.display = "block";
    }
});

// Initialisation : afficher le formulaire de carte par défaut
document.getElementById("carte-info").style.display = "block";
</script>
{% endblock %}
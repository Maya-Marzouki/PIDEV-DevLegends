{% extends 'baseAdmin.html.twig' %}

{% block title %}Modifier l'Article{% endblock %}

{% block body %}
<div class="container mt-5 mb-5"> {# Ajout d'un margin-bottom pour éviter le chevauchement #}
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg p-4">
                <h1 class="text-center mb-4">Modifier l'Article de Conseil</h1>

                {# Affichage des erreurs globales du formulaire #}
                {# {% if form.vars.errors|length > 0 %}
                    <div class="alert alert-danger">
                        <strong>Des erreurs sont survenues :</strong>
                        <ul>
                            {% for error in form.errors %}
                                <li>{{ error.message }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %} #}

                {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}

                    <div class="mb-3">
                        {{ form_label(form.titreArticle, 'Titre de l\'Article', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.titreArticle, {'attr': {'class': 'form-control', 'placeholder': 'Entrez le titre de l\'article'}}) }}
                        <div class="text-danger">{{ form_errors(form.titreArticle) }}</div>
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.contenuArticle, 'Contenu de l\'Article', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.contenuArticle, {'attr': {'class': 'form-control', 'rows': 5, 'placeholder': 'Entrez le contenu de l\'article'}}) }}
                        <div class="text-danger">{{ form_errors(form.contenuArticle) }}</div>
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.categorieMentalArticle, 'Catégorie', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.categorieMentalArticle, {'attr': {'class': 'form-control'}}) }}
                        <div class="text-danger">{{ form_errors(form.categorieMentalArticle) }}</div>
                    </div>

                    {# <div class="mb-3">
                        {{ form_label(form.image, 'URL de l\'Image', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.image, {'attr': {'class': 'form-control', 'placeholder': 'choisissez une image', 'oninput': 'updatePreview()'}}) }}
                        <div class="text-danger">{{ form_errors(form.image) }}</div>
                    </div>

                    <div class="mb-3 text-center">
                        <img id="imagePreview" src="{{ form.image.vars.value ?: 'https://via.placeholder.com/500x300?text=Aperçu+de+l\'image' }}" class="img-fluid rounded shadow" alt="Aperçu de l'image" style="max-width: 300px;">
                    </div> #}

                    <!-- Aperçu de l'image actuelle -->
                    {% if articleConseil.image %}
                    <div class="mb-3 text-center">
                        <h5>Image actuelle :</h5>
                        <img id="imagePreview" 
                             src="{{ asset(articleConseil.image) }}" 
                             class="img-fluid rounded shadow" 
                             alt="Aperçu de l'image"
                             style="max-width: 300px;">
                    </div>
                    {% endif %}

                    <!-- Champ pour uploader une nouvelle image -->
                    <div class="mb-3">
                        {{ form_label(form.image, 'Nouvelle Image (si vous souhaitez changer)', {'label_attr': {'class': 'form-label'}}) }}
                        {{ form_widget(form.image, {'attr': {'class': 'form-control', 'onchange': 'previewNewImage(this)'}}) }}
                        <div class="text-danger">{{ form_errors(form.image) }}</div>
                    </div>

                    <!-- Aperçu de la nouvelle image uploadée -->
                    <div class="mb-3 text-center">
                        <img id="newImagePreview" src="#" class="img-fluid rounded shadow d-none" alt="Nouvel aperçu" style="max-width: 300px;">
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ path('app_articles_conseils_admin') }}" class="btn btn-custom-green py-3 px-4">Voir la liste des articles</a>
                        <button type="submit" class="btn btn-custom-green py-3 px-4">Enregistrer les modifications</button>
                    </div>

                {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

<!-- JavaScript pour afficher un aperçu de la nouvelle image uploadée -->
<script>
    function previewNewImage(input) {
        let file = input.files[0];
        let preview = document.getElementById("newImagePreview");

        if (file) {
            let reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.classList.remove("d-none");
            }
            reader.readAsDataURL(file);
        } else {
            preview.classList.add("d-none");
        }
    }
</script>
<!-- JavaScript pour mettre à jour l'aperçu de l'image -->
{# <script>
    function updatePreview() {
        let image = document.querySelector("input[name='image']").value;
        let preview = document.getElementById("imagePreview");
        preview.src = image || "https://via.placeholder.com/500x300?text=Aperçu+de+l'image";
    }
</script> #}

<style>
    /* Assure que la page prend toute la hauteur et que le footer ne chevauche pas */
    html, body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* Espace entre le formulaire et le footer */
    .container {
        flex: 1;
    }

    /* Style personnalisé pour les boutons */
    .btn-custom-green {
        background-color: #28a745 !important; /* Vert Bootstrap */
        color: white !important; /* Texte blanc */
        font-weight: bold;
        border-radius: 8px; /* Coins arrondis */
        transition: background-color 0.3s ease-in-out;
    }

    .btn-custom-green:hover {
        background-color: #218838 !important; /* Vert plus foncé au survol */
    }

    /* Footer fixe en bas uniquement si la page est courte */
    .footer-fixed {
        position: relative;
        bottom: 0;
        width: 100%;
        background: #f8f9fa;
        padding: 10px;
        text-align: center;
    }
</style>

{% endblock %}

{% extends 'baseAdmin.html.twig' %}

{% block body %}
<div class="row d-flex justify-content-center"> {# Centre le tableau horizontalement #}
    <div class="col-lg-10"> {# Réduit la largeur du tableau pour qu'il soit mieux centré #}
        <div class="card">
            <div class="card-block text-center"> {# Centre le texte dans la carte #}
                <h4 class="card-title">Liste des Consultations</h4>
                <h6 class="card-subtitle">Gestion des consultations</h6>

                {# Barre de recherche AJAX #}
<div class="mb-4 text-left">
    <form id="search-form" class="form-inline">
        <input type="text" name="q" id="search-query" value="{{ searchQuery }}" class="form-control mr-2" placeholder="Rechercher une consultation...">
        <button type="submit" class="btn btn-secondary ml-2">Rechercher</button>
        <a href="{{ path('consultation_index') }}" class="btn btn-secondary ml-2">Réinitialiser</a>
    </form>
</div>

                {# Nombre de résultats #}
                <div class="text-left mb-3"> {# Aligner à gauche #}
                    {% if consultations|length > 0 %}
                        <p>Nombre de résultats : {{ consultations|length }}</p>
                    {% else %}
                        <p>Aucun résultat trouvé.</p>
                    {% endif %}
                </div>

                {# Tableau des consultations #}
                <div id="consultation-table" class="table-responsive">
    <table class="table table-bordered text-center">
        <!-- En-têtes du tableau -->
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Date</th>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Âge</th>
                <th>Profession</th>
                <th>Raison(s) de la consultation thérapeutique</th>
                <th>Actions</th>
            </tr>
        </thead>
        <!-- Corps du tableau -->
        <tbody id="consultation-body">
            {% for consultation in consultations %}
                <tr>
                    <td>{{ consultation.id }}</td>
                    {# <td>{{ userId }}</td> Affiche l'ID de l'utilisateur connecté #}
                    <td>{{ consultation.dateCons|date('Y-m-d') }}</td>
                    <td>{{ consultation.Nom }}</td>
                    <td>{{ consultation.prenom }}</td>
                    <td>{{ consultation.age }}</td>
                    <td>{{ consultation.lienVisioCons }}</td>
                    <td>{{ consultation.notesCons }}</td>
                    <td>
                        <a href="{{ path('edit_consultation_Admin', { id: consultation.id }) }}" class="btn btn-secondary btn-sm">Modifier</a>
                        <form action="{{ path('delete_consultation_Admin', {'id': consultation.id}) }}" method="post" onsubmit="return confirm('Voulez-vous vraiment supprimer cette consultation ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ consultation.id) }}">
                            <button type="submit" class="btn btn-secondary btn-sm">Supprimer</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="8" class="text-center">Aucune consultation disponible.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{# Affichage de la pagination #}
<div class="d-flex justify-content-center mt-3">
    <nav aria-label="Pagination">
        <ul class="pagination pagination-green">
            {# Lien vers la page précédente #}
            {% if currentPage > 1 %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('consultation_index', { q: searchQuery, page: currentPage - 1 }) }}">Précédent</a>
                </li>
            {% endif %}

            {# Liens vers les pages #}
            {% for i in 1..totalPages %}
                <li class="page-item {% if i == currentPage %}active{% endif %}">
                    <a class="page-link" href="{{ path('consultation_index', { q: searchQuery, page: i }) }}">{{ i }}</a>
                </li>
            {% endfor %}

            {# Lien vers la page suivante #}
            {% if currentPage < totalPages %}
                <li class="page-item">
                    <a class="page-link" href="{{ path('consultation_index', { q: searchQuery, page: currentPage + 1 }) }}">Suivant</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
<style>
    .pagination-green .page-item .page-link {
        color: #28a745; /* Couleur du texte en vert */
        background-color: #ffffff; /* Fond blanc */
        border-color: #28a745; /* Bordure verte */
    }

    .pagination-green .page-item.active .page-link {
        background-color: #28a745; /* Fond vert pour la page active */
        border-color: #28a745; /* Bordure verte pour la page active */
        color: #ffffff; /* Texte blanc pour la page active */
    }

    .pagination-green .page-item:hover .page-link {
        background-color: #218838; /* Fond vert plus foncé au survol */
        border-color: #218838; /* Bordure verte plus foncée au survol */
        color: #ffffff; /* Texte blanc au survol */
    }
</style>


            </div>
        </div>

        {# Bouton "Ajouter une Consultation" en bas à droite #}
        <style>
            .btn-custom-green {
                background-color: #28a745 !important; /* Vert Bootstrap */
                color: white !important; /* Texte blanc */
                font-weight: bold;
            }
        </style>
        <div class="d-flex justify-content-end mt-3">
            <a href="{{ path('consultation_export_pdf') }}" class="btn btn-custom-green">
                <i class="fas fa-file-pdf"></i> Exporter en PDF
            </a>
            <a href="{{ path('consultation_qr_code') }}" class="btn btn-custom-green">
                <i class="fas fa-qrcode"></i> Générer QR Code
            </a>
        </div>
    </div>
</div>
{% endblock %}
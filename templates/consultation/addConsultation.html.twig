{% extends 'base.html.twig' %}

{% block title %}Ajouter une Consultation{% endblock %}

{% block body %}
{# {{ form_start(form,{'attr': {'novalidate': 'novalidate'}}) }} #}

    <div class="container-fluid py-5">
        <div class="container">
            <div class="text-center mx-auto wow fadeInUp" data-wow-delay="0.1s" style="max-width: 500px;">
                <p class="fs-5 fw-bold text-primary">Nouvelle Consultation</p>
                <h1 class="display-5 mb-5">Remplissez le formulaire</h1>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-7">
                    <div class="bg-light rounded p-4 p-sm-5 wow fadeInUp" data-wow-delay="0.1s">
                    {{ form_start(form, {'attr': {'class': 'row g-3','novalidate': 'novalidate'}}) }}

                        {# Affichage des erreurs globales du formulaire #}
                        {% if form.vars.errors|length > 0 %}
                            <div class="alert alert-danger">
                                <strong>Des erreurs sont survenues :</strong>
                                <ul>
                                    {% for error in form.vars.errors %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}

                        <div class="col-sm-6">
                            <div class="form-floating">
                                {{ form_widget(form.nom, {'attr': {'class': 'form-control border-0', 'placeholder': 'Nom'}}) }}
                                {{ form_label(form.nom) }}
                                <div class="text-danger">{{ form_errors(form.nom) }}</div>

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-floating">
                                {{ form_widget(form.prenom, {'attr': {'class': 'form-control border-0', 'placeholder': 'Prénom'}}) }}
                                {{ form_label(form.prenom) }}
                                <div class="text-danger">{{ form_errors(form.prenom) }}</div>

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-floating">
                                {{ form_widget(form.age, {'attr': {'class': 'form-control border-0', 'placeholder': 'Âge'}}) }}
                                {{ form_label(form.age) }}
                                <div class="text-danger">{{ form_errors(form.age) }}</div>

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-floating">
                                {{ form_widget(form.dateCons, {'attr': {'class': 'form-control border-0', 'placeholder': 'Date de consultation'}}) }}
                                {{ form_label(form.dateCons) }}
                                <div class="text-danger">{{ form_errors(form.dateCons) }}</div>

                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-floating">
                                {{ form_widget(form.lienVisioCons, {'attr': {'class': 'form-control border-0', 'placeholder': 'Entrez votre profession'}}) }}
                                {{ form_label(form.lienVisioCons) }}
                                <div class="text-danger">{{ form_errors(form.lienVisioCons) }}</div>

                            </div>
                        </div>
                        {# <div class="col-sm-6">
                            <div class="form-floating">
                                {{ form_widget(form.scoreMental, {'attr': {'class': 'form-control border-0', 'placeholder': 'Score Mental'}}) }}
                                {{ form_label(form.scoreMental) }}
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-floating">
                                {{ form_widget(form.etatMental, {'attr': {'class': 'form-control border-0', 'placeholder': 'État Mental'}}) }}
                                {{ form_label(form.etatMental) }}
                            </div>
                        </div>  #}
                        <div class="col-12">
                            <div class="form-floating">
                                {{ form_widget(form.notesCons, {'attr': {'class': 'form-control border-0', 'placeholder': 'Raison(s) de la consultation thérapeutique'}}) }}
                                {{ form_label(form.notesCons) }}
                                <div class="text-danger">{{ form_errors(form.notesCons) }}</div>

                            </div>
                        </div>
                        <div class="col-12 text-center">
                            <button class="btn btn-primary py-3 px-4" type="submit">Enregistrer</button>
                        </div>

                        {{ form_end(form) }}

                        <div class="col-12 text-center mt-3">
                            <a href="{{ path('consultation_view') }}" class="btn btn-secondary">Retour à la liste</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{# {{ form_end(form) }} #}
        {# <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('consultation-form');
            const fields = [
                { id: '{{ form.dateCons.vars.id }}', errorId: 'dateCons-error' },
                { id: '{{ form.lienVisioCons.vars.id }}', errorId: 'lienVisioCons-error' },
                { id: '{{ form.notesCons.vars.id }}', errorId: 'notesCons-error' },
            ];

            fields.forEach(field => {
                const input = document.getElementById(field.id);
                const error = document.getElementById(field.errorId);

                input.addEventListener('input', function () {
                    if (input.validity.valid) {
                        error.textContent = '';
                        input.classList.remove('is-invalid');
                    } else {
                        error.textContent = input.validationMessage;
                        input.classList.add('is-invalid');
                    }
                });
            });
        });
    </script> #}

    <style>
        .is-invalid {
            border-color: #dc3545 !important;
        }
        .text-danger {
            color: #dc3545;
        }
    </style>
{% endblock %}
